@if (selectedSensor) {
  <div class="sidebar">
    <div class="sidebar-header">
      <div>
        <span class="label">SENSOR: {{selectedSensor.name | uppercase}}</span>
        <div class="location">Loc: {{selectedSensor.description}}</div>
      </div>
      <button class="close-btn" (click)="closeSidebar()" aria-label="Close details panel">√ó</button>
    </div>
    <div class="status-card" [style.border-left-color]="congestionColor">
      <div class="status-indicator" [style.background-color]="congestionColor"></div>
      <div class="status-info">
        <div class="status-label">{{congestionLevel.replace('_', ' ') | uppercase}}</div>
        <div class="ci-value">CI: {{currentData?.congestionIndex | number:'1.2-2'}}</div>
      </div>
    </div>
    <div class="metrics-grid">
      <div class="metric-item">
        <div class="icon">üöó</div>
        <div class="metric-content">
          <div class="metric-label">Avg Speed</div>
          <div class="metric-value">
            <span [@valueChange]="currentData?.avgSpeed">{{currentData?.avgSpeed}}</span>
            <span class="unit">km/h</span>
            <svg class="sparkline" width="100" height="30" *ngIf="currentData?.history">
              <path [attr.d]="getSparklinePath(currentData!.history, 120)" fill="none" stroke="currentColor" stroke-width="2" />
            </svg>
          </div>
        </div>
      </div>
      <div class="metric-item">
        <div class="icon">üìä</div>
        <div class="metric-content">
          <div class="metric-label">Volume</div>
          <div class="metric-value">
            <span [@valueChange]="currentData?.vehicleCount">{{currentData?.vehicleCount}}</span>
            <span class="unit">vehs/int</span>
            <svg class="sparkline" width="100" height="30" *ngIf="currentData?.vehicleHistory">
              <path [attr.d]="getSparklinePath(currentData!.vehicleHistory, 150)" fill="none" stroke="currentColor" stroke-width="2" />
            </svg>
          </div>
        </div>
      </div>
    </div>
    <div class="context-info">
      <h3>Speed Limit</h3>
      <div class="speed-limit-sign">
        <span class="speed-value">{{currentData?.speedLimit || '--'}}</span>
      </div>
    </div>

    <div class="alerts-section" *ngIf="sensorAlerts.length > 0">
      <h3>Alert History</h3>
      <div class="alert-list">
        <div class="alert-item" *ngFor="let alert of sensorAlerts">
          <div class="alert-icon">‚ö†Ô∏è</div>
          <div class="alert-details">
            <span class="alert-time">{{alert.timestamp | date:'shortTime'}}</span>
            <span class="alert-msg">Ghost Driver ({{alert.details.speed_kph}} km/h)</span>
            <span class="alert-plate">{{alert.details.license_plate}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
}
